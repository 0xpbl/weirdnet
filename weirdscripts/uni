#!/usr/bin/env bash
set -euo pipefail

# diretório onde este script está
SCRIPT_DIR="$(cd -- "$(dirname -- "${BASH_SOURCE[0]}")" >/dev/null 2>&1 && pwd)"

# raiz do _src (um nível acima do weirdscripts)
SRC_DIR="$(cd -- "$SCRIPT_DIR/.." >/dev/null 2>&1 && pwd)"

# agora o HOME é o próprio weirdscripts (onde estão links.txt/dir.txt)
export WEIRDNET_HOME="${WEIRDNET_HOME:-$SCRIPT_DIR}"
export WEIRDNET_SRC="$SRC_DIR"

# validações
if [[ ! -d "$SRC_DIR" ]]; then
  echo "[FAIL] SRC_DIR não existe: $SRC_DIR" >&2
  exit 1
fi

# Criar dir.txt e links.txt se não existirem
if [[ ! -f "$WEIRDNET_HOME/dir.txt" ]]; then
  touch "$WEIRDNET_HOME/dir.txt"
fi

if [[ ! -f "$WEIRDNET_HOME/links.txt" ]]; then
  touch "$WEIRDNET_HOME/links.txt"
fi

# roda uni.mjs
cd "$SRC_DIR"
exec node "$SCRIPT_DIR/tools/uni.mjs" "$@"
